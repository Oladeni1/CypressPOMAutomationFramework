# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript
# Custom build to run automated tests with Cypress

trigger:
  - master
  - develop
  - feature/*

pool:
  vmImage: $(imageName)

variables:
  ${{ if eq(variables['Build.SourceBranchName'], 'master') }}: # only works if you have a master branch
    configFile: QA
  ${{ if eq(variables['Build.SourceBranchName'], 'develop') }}: # only works if you have a develop branch
    configFile: development
  ${{ if not(or(eq(variables['Build.SourceBranchName'], 'develop'), eq(variables['Build.SourceBranchName'], 'master'))) }}:
    configFile: development

stages:
  # Default stage (to run tests in Electron environment)
  - template: templates/stages/defaultStage.yml
    parameters:
      imageName: 'ubuntu-latest'

  - template: templates/stages/chromeStage.yml
    parameters:
      imageName: 'ubuntu-latest'

  - template: templates/stages/firefoxStage.yml
    parameters:
      imageName: 'ubuntu-latest'

  - template: templates/stages/edgeStage.yml
    parameters:
      imageName: 'windows-latest'

